# Развертывание сервера Calibre Ebook

## Описание

Данный плэйбук Ansible предназначен для автоматического развертывания сервера Calibre Ebook на целевых хостах.

## Возможности

- Применяет базовые настройки файрвола (через роль `firewall`).
- Устанавливает необходимые зависимости (через роль `install_depend`).
- Проверяет наличие установленного Calibre.
- Если Calibre не установлен, скачивает официальный установочный скрипт и выполняет его.
- Создаёт отдельного пользователя `calibre`.
- Конфигурирует директорию библиотеки Calibre.
- Проверяет существование библиотеки Calibre и инициализирует её при необходимости.
- Создаёт и управляет systemd-сервисом для Calibre Server.
- Удаляет установочный скрипт после успешной установки.

## Требования

- Установленный Ansible на управляющем узле.
- SSH-доступ к целевой системе.
- Права sudo на целевой системе.

## Протестировано на

- **Ubuntu:** `22`

## Установка

### 1. Настройка переменных

Обновите файл `vars/calibre.yml`, указав необходимые параметры:

```yaml
# Переменные для роли firewall
firewall_ports:
  - 8080/tcp # Пример порта для доступа к веб-интерфейсу Calibre
firewall_services: [] # Дополнительные сервисы, если нужны

# Переменные для роли install_depend
depended:
  - some_package_1 # Пример зависимости
  - some_package_2 # Пример зависимости

calibre_user: calibre
calibre_service: calibre-server
```

### 2. Запуск Playbook

Выполните команду:

```sh
ansible-playbook -i inventory deploy-calibre.yml
```

Где `inventory` — ваш инвентарь с целевыми хостами.

## Настройка

Вы можете изменить настройки брандмауэра, изменив переменную `firewall_ports` и `firewall-service` в файле конфигурации роли.

## Systemd-сервис

Playbook создаёт systemd-сервис для Calibre Server, используя шаблон `templates/calibre.service.j2`. Если требуется изменить поведение сервиса, обновите этот файл.
